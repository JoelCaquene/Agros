{% extends "base.html" %}
{% load static %}

{% block title %}agros - Dashboard Profissional{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

{# 1. POP-UP DE BOAS-VINDAS PERSONALIZADO #}
<style>
    /* Estilização rápida para garantir o visual bonito */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }

    .modal-content-white {
        background: #fff;
        padding: 25px;
        border-radius: 15px;
        width: 90%;
        max-width: 320px; /* Tamanho pequeno e elegante */
        text-align: center;
        position: relative;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }

    .modal-logo-blue {
        color: #007bff;
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 10px;
        text-transform: lowercase;
    }

    .modal-text {
        font-size: 14px;
        color: #555;
        margin-bottom: 20px;
        line-height: 1.4;
    }

    .btn-whatsapp-new {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
        color: white;
        text-decoration: none;
        padding: 12px;
        border-radius: 8px;
        font-weight: bold;
        transition: transform 0.2s;
    }

    .btn-whatsapp-new:hover {
        transform: scale(1.03);
    }

    .btn-x-close {
        position: absolute;
        top: 10px;
        right: 15px;
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: #999;
    }
</style>

<div id="welcomeModal" class="modal-overlay">
    <div class="modal-content-white animate-in">
        <button class="btn-x-close" onclick="closeModal()">×</button>
        
        <div class="modal-body-clean">
            <h2 class="modal-logo-blue">agros</h2>
            <p class="modal-text">Acesse a comunidade, para suporte geral:</p>
            
            <a href="{{ whatsapp_link }}" target="_blank" class="btn-whatsapp-new">
                <i class="fab fa-whatsapp"></i>
                <span>GRUPO WHATSAPP</span>
            </a>
        </div>
    </div>
</div>

<div class="forex-dashboard">
    
    {# 2. TOPO COM NOME ANIMADO E BRILHO DOURADO #}
    <div class="top-header-clean">
        <div class="anim-container">
            <h1 class="moving-name">agros</h1>
        </div>
    </div>

    {# 3. CARROSSEL DE IMAGENS (REDUZIDO ESPAÇAMENTO) #}
    <div class="swiper main-carousel">
        <div class="swiper-wrapper">
            <div class="swiper-slide"><img src="{% static 'images/slide1.jpg' %}" alt="Slide 1"></div>
            <div class="swiper-slide"><img src="{% static 'images/slide2.jpg' %}" alt="Slide 2"></div>
            <div class="swiper-slide"><img src="{% static 'images/slide3.jpg' %}" alt="Slide 3"></div>
        </div>
        <div class="swiper-pagination"></div>
    </div>

    {# 4. PAINEL PRETO COM GRID DE AÇÕES #}
    <div class="black-panel-container">
        <div class="action-grid-clean">
            <a href="{% url 'deposito' %}" class="action-item-new">
                <div class="icon-box-shiny"><i class="fas fa-shield-halved"></i></div>
                <span>Recarga</span>
            </a>
            <a href="{% url 'tarefa' %}" class="action-item-new">
                <div class="icon-box-shiny"><i class="fas fa-laptop-code"></i></div>
                <span>Produção</span>
            </a>
            <a href="{% url 'nivel' %}" class="action-item-new">
                <div class="icon-box-shiny"><i class="fas fa-stairs"></i></div>
                <span>VIP</span>
            </a>
            <a href="{% url 'perfil' %}" class="action-item-new">
                <div class="icon-box-shiny"><i class="fas fa-building-columns"></i></div>
                <span>Meus</span>
            </a>
            <a href="{% url 'saque' %}" class="action-item-new">
                <div class="icon-box-shiny"><i class="fas fa-money-check-dollar"></i></div>
                <span>Saquês</span>
            </a>
        </div>
    </div>

    {# 5. ROLETA COM FOGOS DE ARTIFÍCIO #}
    <div class="roleta-container">
        <a href="{% url 'roleta' %}" class="roleta-glow-link">
            <div class="roleta-spin-wrapper" id="roletaWrapper">
                <img src="{% static 'images/roleta_img.png' %}" class="roleta-img-rotating" alt="Roleta">
                <div class="roleta-center-text">SORTEIO</div>
            </div>
        </a>
    </div>

</div>

<style>
    :root {
        --bg-pure-white: #ffffff;
        --shiny-gray: linear-gradient(145deg, #f9f9f9, #e0e0e0);
        --blue-agros: #003366;
        --gold-glow: 0 0 10px #ffd700, 0 0 20px #ff8c00;
    }

    html, body {
        margin: 0; padding: 0;
        background: var(--bg-pure-white) !important;
        font-family: 'Poppins', sans-serif;
        overflow-x: hidden;
    }

    .forex-dashboard { width: 100%; max-width: 500px; margin: 0 auto; padding-top: 5px; }

    /* NOME ANIMADO COM SOMBRA DOURADA */
    .top-header-clean { padding: 5px 15px; height: 40px; position: relative; }
    .anim-container { position: relative; width: 100%; height: 100%; }
    .moving-name {
        position: absolute; font-weight: 900; font-size: 26px; 
        color: var(--blue-agros);
        text-shadow: var(--gold-glow);
        animation: swingName 5s ease-in-out infinite alternate;
        margin: 0;
        text-transform: lowercase;
    }
    @keyframes swingName {
        from { left: 0%; transform: scale(1); }
        to { left: calc(100% - 85px); transform: scale(1.1); }
    }

    /* CARROSSEL AJUSTADO PARA CIMA */
    .main-carousel { width: 95%; height: 170px; border-radius: 15px; margin: 0 auto 10px auto; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .main-carousel img { width: 100%; height: 100%; object-fit: cover; }

    /* PAINEL PRETO LIMITADO */
    .black-panel-container {
        background: #111111;
        margin: 0 10px;
        padding: 15px 5px;
        border-radius: 20px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    .action-grid-clean {
        display: grid; grid-template-columns: repeat(5, 1fr);
        gap: 2px;
    }
    .action-item-new { display: flex; flex-direction: column; align-items: center; text-decoration: none; }
    
    /* BOTÕES CINZA BRILHANTE */
    .icon-box-shiny {
        width: 50px; height: 50px;
        background: var(--shiny-gray);
        border-radius: 14px;
        display: flex; align-items: center; justify-content: center;
        color: var(--blue-agros); font-size: 22px;
        box-shadow: inset 2px 2px 5px #fff, 3px 3px 8px rgba(0,0,0,0.1);
        margin-bottom: 6px;
        transition: 0.3s;
    }
    .action-item-new span { font-size: 8px; font-weight: 800; color: #eee; text-transform: uppercase; letter-spacing: 0.5px; }

    /* ROLETA E FOGOS */
    .roleta-container { display: flex; justify-content: center; padding: 20px 0; position: relative; }
    .roleta-spin-wrapper {
        position: relative; width: 220px; height: 220px;
        filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.4));
    }
    .roleta-img-rotating { width: 100%; height: 100%; animation: rotateFull 10s linear infinite; }
    .roleta-center-text {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: linear-gradient(to bottom, #ffd700, #ff8c00); 
        color: #000; padding: 10px 15px; border-radius: 25px;
        font-weight: 900; font-size: 12px; border: 2px solid #fff;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    @keyframes rotateFull { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* MODAL */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 10000; backdrop-filter: blur(5px); }
    .modal-content-white { width: 300px; background: #fff; border-radius: 25px; overflow: hidden; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
    .btn-x-close { position: absolute; top: 10px; right: 15px; background: rgba(0,0,0,0.5); border: none; font-size: 20px; color: #fff; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; z-index: 11; }
    .modal-logo-blue { color: var(--blue-agros); font-weight: 900; margin: 15px 0; }
    .btn-whatsapp-new { background: #25d366; color: #fff; text-decoration: none; margin: 0 20px 20px; padding: 12px; border-radius: 15px; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: bold; }
</style>

<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
<script>
    // Inicializar Carrossel
    const swiper = new Swiper('.main-carousel', {
        loop: true,
        autoplay: { delay: 5000, disableOnInteraction: false },
        pagination: { el: '.swiper-pagination', clickable: true },
    });

    // Função para Fogos de Artifício contínuos na roleta
    function launchFireworks() {
        const duration = 15 * 1000;
        const animationEnd = Date.now() + duration;
        const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

        function randomInRange(min, max) {
          return Math.random() * (max - min) + min;
        }

        const interval = setInterval(function() {
          const timeLeft = animationEnd - Date.now();
          if (timeLeft <= 0) return clearInterval(interval);

          const particleCount = 20 * (timeLeft / duration);
          // Soltar das laterais da roleta
          confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
          confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
        }, 2000);
    }

    // Iniciar fogos ao carregar
    window.onload = () => {
        launchFireworks();
        // Repetir fogos periodicamente
        setInterval(launchFireworks, 16000);
    };

    function closeModal() {
        document.getElementById('welcomeModal').style.opacity = '0';
        setTimeout(() => { document.getElementById('welcomeModal').style.display = 'none'; }, 300);
    }
</script>
{% endblock %}
